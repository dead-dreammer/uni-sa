{% extends 'base.html' %} 

{% block title %}Start My Search | uni.sa{% endblock%} 

{% block head_extras %}
  <link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/personal-info.css') }}"
  />
{% endblock %}

{% block content %}
<div class="search-page">
  <!-- Hero Section -->
  <div class="search-hero">
    <div class="search-hero-content">
      <h1>START YOUR SEARCH</h1>
      <p class="hero-subtitle">Find Your Perfect University Match</p>
      <p class="hero-description">
        Answer a few questions and discover universities tailored to you
      </p>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <p class="progress-text"><span id="progressText">0</span>% Complete</p>
  </div>

  <!-- Error Toast Notification -->
  <div id="errorToast" class="error-toast">
    <span id="errorMessage"></span>
  </div>

  <!-- Search Form Section -->
  <section class="search-section">
    <div class="search-form-container">
      <form id="searchForm" class="search-form" method="POST" action="{{ url_for('courses.get_matches') }}" novalidate>
        <input type="hidden" id="studentId" value="{{ session['student_id'] }}">
        <!-- Question 1: Subjects and Marks -->
        <div class="form-card" id="section-subjects">
          <div class="card-header">
            <span class="question-number">01</span>
            <h3>
              Input your marks and subjects below
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <div class="card-body">
            <div id="subjectsContainer">
              <!-- Initial subject entry will be populated by JavaScript -->
            </div>
            <button type="button" id="addSubject" class="add-button">
              <span>+</span> Add Another Subject
            </button>
          </div>
        </div>

        <!-- Question 2: Location -->
        <div class="form-card" id="section-location">
          <div class="card-header">
            <span class="question-number">02</span>
            <h3>
              Where do you currently live?
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <div class="card-body">
            <div class="form-grid">
              <div class="form-group">
                <label>Province</label>
                <select id="province" required title="select province">
                  <option value="">Select Province</option>
                  <option value="gauteng">Gauteng</option>
                  <option value="western-cape">Western Cape</option>
                  <option value="kwazulu-natal">KwaZulu-Natal</option>
                  <option value="eastern-cape">Eastern Cape</option>
                  <option value="free-state">Free State</option>
                  <option value="limpopo">Limpopo</option>
                  <option value="mpumalanga">Mpumalanga</option>
                  <option value="northern-cape">Northern Cape</option>
                  <option value="north-west">North West</option>
                </select>
              </div>
              <div class="form-group">
                <label>Suburb/Area</label>
                <input
                  type="text"
                  id="suburb"
                  placeholder="e.g., Sandton"
                  required
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Question 3: Willing to Relocate -->
        <div class="form-card" id="section-relocate">
          <div class="card-header">
            <span class="question-number">03</span>
            <h3>
              Are you willing to relocate?
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <div class="card-body">
            <div class="radio-group-modern">
              <label class="radio-card">
                <input type="radio" name="relocate" value="yes" required />
                <div class="radio-card-content">
                  <span class="radio-icon">‚úì</span>
                  <span class="radio-text">Yes, I'm willing to relocate</span>
                </div>
              </label>
              <label class="radio-card">
                <input type="radio" name="relocate" value="no" required />
                <div class="radio-card-content">
                  <span class="radio-icon">‚úó</span>
                  <span class="radio-text">No, I prefer to stay local</span>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- Question 4: Study Mode -->
        <div class="form-card" id="section-study-mode">
          <div class="card-header">
            <span class="question-number">04</span>
            <h3>
              Do you prefer studying in contact or distance?
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <div class="card-body">
            <div class="radio-group-modern">
              <label class="radio-card">
                <input type="radio" name="studyMode" value="contact" required />
                <div class="radio-card-content">
                  <span class="radio-icon">üè´</span>
                  <span class="radio-text">Contact (In Person)</span>
                </div>
              </label>
              <label class="radio-card">
                <input
                  type="radio"
                  name="studyMode"
                  value="distance"
                  required
                />
                <div class="radio-card-content">
                  <span class="radio-icon">üíª</span>
                  <span class="radio-text">Distance (Online)</span>
                </div>
              </label>
              <label class="radio-card">
                <input
                  type="radio"
                  name="studyMode"
                  value="hybrid"
                  required
                />
                <div class="radio-card-content">
                  <span class="radio-icon">üíª</span>
                  <span class="radio-text">Hybrid (Both)</span>
                </div>
              </label>
            </div>
          </div>
        </div>
        <!-- Question 5: Preferred Degree / Qualification Type -->

<div class="form-card">
        <div class="card-header">
            <span class="question-number">05</span>
            <h3>
              Qualification Type
              <span class="required-asterisk">*</span>
            </h3>
          </div>
  <div id="preferred_degree_group">
    <label><input type="checkbox" name="preferred_degree" value="certificate"> Certificate</label><br>
    <label><input type="checkbox" name="preferred_degree" value="diploma"> Diploma</label><br>
    <label><input type="checkbox" name="preferred_degree" value="bachelor"> Bachelor's Degree</label><br>
    <label><input type="checkbox" name="preferred_degree" value="honours"> Honours Degree</label><br>
    <label><input type="checkbox" name="preferred_degree" value="postgraduate-diploma"> Postgraduate Diploma</label><br>
    <label><input type="checkbox" name="preferred_degree" value="masters"> Master's Degree</label><br>
    <label><input type="checkbox" name="preferred_degree" value="doctorate"> Doctorate / PhD</label>
  </div>
</div>

        <!-- Question 4: Maximum Tuition Fee -->

        <div class="form-card" >
          <div class="card-header">
          <span class="question-number">06</span>
            <h3>
              Maximum Tuition Fee (R)
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <input type="number" id="max_tuition_fee" placeholder="e.g., 50000" required />
        
        </div>

        <!-- Question 5: Disabilities/Support -->
        <div class="form-card" id="section-support">
          <div class="card-header">
            <span class="question-number">07</span>
            <h3>
              Do you need any academic support?
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <div class="card-body">
            <div class="radio-group-modern">
              <label class="radio-card">
                <input
                  type="radio"
                  name="needSupport"
                  value="yes"
                  id="supportYes"
                  required
                />
                <div class="radio-card-content">
                  <span class="radio-icon">‚úì</span>
                  <span class="radio-text">Yes, I need support</span>
                </div>
              </label>
              <label class="radio-card">
                <input
                  type="radio"
                  name="needSupport"
                  value="no"
                  id="supportNo"
                  required
                />
                <div class="radio-card-content">
                  <span class="radio-icon">‚úó</span>
                  <span class="radio-text">No support needed</span>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- Question 6: Support Details (Conditional) -->
        <div class="form-card hidden" id="section-support-details">
          <div class="card-header">
            <span class="question-number">08</span>
            <h3>
              Please specify the support you need
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <div class="card-body">
            <div class="form-group">
              <textarea
                id="supportDetails"
                rows="4"
                placeholder="Please describe the type of support you need..."
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Question 7: Career Interests -->
        <div class="form-card" id="section-careers">
          <div class="card-header">
            <span class="question-number">09</span>
            <h3>
              Select up to 3 careers that interest you
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <div class="card-body">
            <div id="careersContainer" class="careers-grid">
              <!-- Career dropdowns will be here -->
            </div>
          </div>
        </div>

        <!-- Question 8: NSFAS -->
        <div class="form-card" id="section-nsfas">
          <div class="card-header">
            <span class="question-number">10</span>
            <h3>
              Will you be applying for NSFAS?
              <span class="required-asterisk">*</span>
            </h3>
          </div>
          <div class="card-body">
            <div class="radio-group-modern">
              <label class="radio-card">
                <input type="radio" name="nsfas" value="yes" required />
                <div class="radio-card-content">
                  <span class="radio-icon">‚úì</span>
                  <span class="radio-text">Yes, I'll apply for NSFAS</span>
                </div>
              </label>
              <label class="radio-card">
                <input type="radio" name="nsfas" value="no" required />
                <div class="radio-card-content">
                  <span class="radio-icon">‚úó</span>
                  <span class="radio-text">No, I have other funding</span>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button type="submit" class="submit-button">
            <span>Find My Perfect Match</span>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path
                d="M4 10H16M16 10L11 5M16 10L11 15"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </div>
      </form>
    </div>
  </section>
</div>
{% endblock %} {% block scripts %}
<script>
  // Subject Management
  let subjectCount = 1;
  const maxSubjects = 10;

  // Full subject list - Make it globally accessible
  window.subjects = [
    "Mathematics",
    "Physical Sciences",
    "Life Sciences",
    "Accounting",
    "Business Studies",
    "Economics",
    "Geography",
    "History",
    "EGD",
    "Consumer Studies",
    "Tourism",
    "Mathematics Literacy",
    "Dramatic Arts",
    "Visual Arts",
    "Design",
    "Music",
    "Civil Technology",
    "Electrical Technology",
    "Mechanical Technology",
    "Computer Applications Technology",
    "Information Technology",
    "English Home Language",
    "English First Additional Language",
    "Afrikaans Home Language",
    "Afrikaans First Additional Language",
    "IsiZulu",
    "IsiXhosa",
    "Sepedi",
    "Setswana",
    "Sesotho",
  ];

  // Career list
  const careers = [
    "Accountant",
    "Actuary",
    "Architect",
    "Attorney",
    "Auditor",
    "Biologist",
    "Business Analyst",
    "Chemical Engineer",
    "Chemist",
    "Civil Engineer",
    "Dentist",
    "Data Scientist",
    "Designer",
    "Electrical Engineer",
    "Financial Analyst",
    "Docter",
    "Nurse",
    "Financial Manager",
    "Graphic Designer",
    "Industrial Engineer",
    "IT Specialist",
    "Journalist",
    "Lawyer",
    "Mechanical Engineer",
    "Medical Specialist",
    "Nurse",
    "Occupational Therapist",
    "Optometrist",
    "Pharmacist",
    "Physiotherapist",
    "Pilot",
    "Project Manager",
    "SQL Developer",
    "Software Developer",
    "Teacher",
    "Web Developer",
  ];

  // Initialize career selects
  const careersContainer = document.getElementById("careersContainer");
  for (let i = 1; i <= 3; i++) {
    const formGroup = document.createElement("div");
    formGroup.className = "form-group";
    formGroup.innerHTML = `
            <label>Career ${i}${i === 1 ? " (Required)" : " (Optional)"}</label>
            <select class="career-select" ${i === 1 ? "required" : ""}>
                <option value="">Select Career</option>
                ${careers
                  .map(
                    (c) =>
                      `<option value="${c
                        .toLowerCase()
                        .replace(/\s+/g, "-")}">${c}</option>`
                  )
                  .join("")}
            </select>
        `;
    careersContainer.appendChild(formGroup);
  }

  document.getElementById("addSubject").addEventListener("click", function () {
    if (subjectCount < maxSubjects) {
      subjectCount++;
      const container = document.getElementById("subjectsContainer");
      const newEntry = document.createElement("div");
      newEntry.className = "subject-entry";
      newEntry.innerHTML = `
                <div class="subject-row">
                    <div class="form-group flex-2">
                        <label>Subject</label>
                        <select class="subject-select" required>
                            <option value="">Select Subject</option>
                            ${window.subjects
                              .map(
                                (s) =>
                                  `<option value="${s}">${s}</option>`
                              )
                              .join("")}
                        </select>
                    </div>
                    <div class="form-group flex-1">
                        <label>Mark (%)</label>
                        <input type="number" class="subject-mark" min="0" max="100" placeholder="85" required>
                    </div>
                    <div class="form-group flex-1">
                        <label>Grade</label>
                        <select class="subject-grade" required>
                            <option value="">Grade</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                    </div>
                    <button type="button" class="btn-remove-subject" title="Remove Subject">√ó</button>
                </div>
            `;
      container.appendChild(newEntry);
    }
  });

  document
    .getElementById("subjectsContainer")
    .addEventListener("click", function (e) {
      if (e.target.classList.contains("btn-remove-subject")) {
        e.target.closest(".subject-entry").remove();
        subjectCount--;
      }
    });

  // Show/Hide Support Details
  document.querySelectorAll('input[name="needSupport"]').forEach((radio) => {
    radio.addEventListener("change", function () {
      const detailsSection = document.getElementById("section-support-details");
      const detailsTextarea = document.getElementById("supportDetails");
      if (this.value === "yes") {
        detailsSection.classList.remove("hidden");
        detailsTextarea.required = true;
      } else {
        detailsSection.classList.add("hidden");
        detailsTextarea.required = false;
        detailsTextarea.value = "";
      }
    });
  });

  // Error Toast Function
  function showError(message, sectionId) {
    const toast = document.getElementById("errorToast");
    const errorMessage = document.getElementById("errorMessage");
    errorMessage.textContent = message;
    toast.classList.add("show");

    const section = document.getElementById(sectionId);
    if (section) {
      section.classList.add("error-highlight");
      section.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    setTimeout(() => {
      toast.classList.remove("show");
      if (section) section.classList.remove("error-highlight");
    }, 3000);
  }

  // Progress tracking
  function updateProgress() {
    const form = document.getElementById("searchForm");
    const sections = form.querySelectorAll(".form-card");
    let completed = 0;

    sections.forEach((section) => {
      const inputs = section.querySelectorAll(
        "input[required], select[required], textarea[required]"
      );
      let sectionComplete = true;

      inputs.forEach((input) => {
        if (input.type === "radio") {
          const radioGroup = section.querySelectorAll(
            `input[name="${input.name}"]`
          );
          const checked = Array.from(radioGroup).some((r) => r.checked);
          if (!checked) sectionComplete = false;
        } else if (!input.value) {
          sectionComplete = false;
        }
      });

      if (sectionComplete) completed++;
    });

    const percentage = Math.round((completed / sections.length) * 100);
    document.getElementById("progressFill").style.width = percentage + "%";
    document.getElementById("progressText").textContent = percentage;
  }

  // Update progress on any form change
  document
    .getElementById("searchForm")
    .addEventListener("change", updateProgress);
  document
    .getElementById("searchForm")
    .addEventListener("input", updateProgress);
</script>
<script src="{{ url_for('static', filename='js/personal-info.js') }}"></script>
{% endblock %}
